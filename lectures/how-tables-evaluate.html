<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Class summary: How Tables Evaluate</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="notes.css" title="default"/><link rel="stylesheet" type="text/css" href="scribble-style.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Class summary:<span class="mywbr"> &nbsp;</span> How Tables Evaluate</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Summary_of_.Table_.Operations_.So_.Far%29" class="tocviewlink" data-pltdoc="x">Summary of Table Operations So Far</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Seeing_.When_.Table_.Functions_are_.Evaluated%29" class="tocviewlink" data-pltdoc="x">Seeing When Table Functions are Evaluated</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.Class_summary__.How_.Tables_.Evaluate%29" class="tocsubseclink" data-pltdoc="x">Class summary:<span class="mywbr"> &nbsp;</span> How Tables Evaluate</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Summary_of_.Table_.Operations_.So_.Far%29" class="tocsubseclink" data-pltdoc="x">Summary of Table Operations So Far</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Seeing_.When_.Table_.Functions_are_.Evaluated%29" class="tocsubseclink" data-pltdoc="x">Seeing When Table Functions are Evaluated</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><h2><a name="(part._.Class_summary__.How_.Tables_.Evaluate)"></a>Class summary: How Tables Evaluate</h2><p>Copyright (c) 2017 Kathi Fisler</p><p>We began with a brief review of the tables functions that we saw in
the previous lecture.</p><p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">gradebook = table: name, SNC, exam1, exam2</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">row: "Allie", false, 85, 90</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">row: "Carl",</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">false, 75, 60</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">row: "Elan", true, 95, 63</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">row: "Lavon", false, 87, 88</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">row: "Nunu", true, 70, 0</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">end</span></p></td></tr></table></p><p>We also introduced a new operation, <span class="stt">build-column</span>, which can be
used to add a new column to a table.  Here is an example of adding a
column containing the average of the two exam grades:</p><p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"># add a column with the average of the exam grades</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">fun exam-avg(r :: Row) -&gt; Number:</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(r["exam1"] + r["exam2"]) / 2</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">end</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">build-column(gradebook, "avg", exam-avg)</span></p></td></tr></table></p><p>Like <span class="stt">filter-by</span>, <span class="stt">build-column</span> takes a function as an
input. This function computes the value that should be in the cell of
the new column for the given row.</p><p>If you try out this code in the interactions window, then ask to see
the gradebook again, the new "avg" column isn&rsquo;t there.  What happened?
Table functions in Pyret do not modify the table they are operating
over.  They return a new table, leaving the old table intact. This is
actually an extremely useful feature of programming, and we will
explore this issue further in the coming lectures.</p><h3>1<tt>&nbsp;</tt><a name="(part._.Summary_of_.Table_.Operations_.So_.Far)"></a>Summary of Table Operations So Far</h3><p>As a summary, here are the functions we&rsquo;ve been working with,
summarized with their types (read <span class="stt">::</span> as "has the type"). We show
them here to reiterate that <span class="stt">filter-by</span> and <span class="stt">build-column</span>
take functions as arguments, and that each of these functions takes a
row as input.</p><div class="priorProg"><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">filter-by :: (t :: Table, (test :: Row-&gt;Boolean)) -&gt; Table</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">sort-by :: (t :: Table, col :: String, ascending :: Boolean) -&gt; Table</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt">build-column :: (T :: Table, col :: String,</span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">builder :: (Row -&gt; Value)) -&gt; Table</span></p></td></tr></table></div><p>Why do the functions for building and filtering take entire rows,
rather than just the columns we need?  <span class="stt">filter-by</span> supports
filters over any collection of columns.  Pyret can&rsquo;t guess which data
a particular filtering might need, so it provides the entire row to
all functions, leaving the functions to extract the data that they
need and to ignore the rest.</p><h3>2<tt>&nbsp;</tt><a name="(part._.Seeing_.When_.Table_.Functions_are_.Evaluated)"></a>Seeing When Table Functions are Evaluated</h3><p>One common confusion with using functions like <span class="stt">filter-by</span> is
understanding when the row-function (like <span class="stt">taking-SNC</span>) gets
called.  We write the row-functions in our file, but we don&rsquo;t
explicitly call them.  So what calls these functions and when?</p><p>Internally, <span class="stt">filter-by</span> calls <span class="stt">taking-SNC</span>, once for each
row.  <span class="stt">filter-by</span> considers each row from top to bottom, passes
it to <span class="stt">taking-SNC</span>, and creates a new table containing the rows
for which <span class="stt">taking-SNC</span> returns true.</p><p>We also saw an initial demo of a new tool for Pyret that shows the
sequence of function calls that get made when evaluating an expression.
To use the tool, start Pyret from the following URL instead:</p><p><a href="http://cpo.herokuapp.com/editor">http://cpo.herokuapp.com/editor</a></p><p>Instead of a Run button, this version has a button marked "Trace and
Run".  Press this to run your program.  If you want to trace a
particular expression, evaluate it at the Interactions prompt, then
hit "Trace Last".  You&rsquo;ll see a diagram of the function calls that got
made while evaluating your expression.  The function calls get made
from left to right. If some function call in turn makes other calls, the
circle for that call is a solid blue circle that you can expand. All
of the expanded calls occur before the next "sibling" call.  See the
lecture capture (starting at minute 9) for details.</p><p>(Ignore the top-left dropdown for now &ndash; keep it on breadth-first, and
we&rsquo;ll come to the other options later)</p></div></div><div id="contextindicator">&nbsp;</div></body></html>